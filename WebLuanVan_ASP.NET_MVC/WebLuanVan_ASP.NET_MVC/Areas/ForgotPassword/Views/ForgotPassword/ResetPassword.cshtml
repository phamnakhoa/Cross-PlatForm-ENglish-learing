@{
    ViewData["Title"] = "Đặt lại mật khẩu";
    Layout = "~/Areas/Login/Views/Shared/_LayoutLogin.cshtml";
    var contact = ViewBag.Contact as string ?? "";
    var method = ViewBag.Method as string ?? "";
    var otp = ViewBag.Otp as string ?? "";
    var error = ViewBag.Error as string ?? "";
}

<div class="text-center mb-4">
    <h4>Đặt lại mật khẩu</h4>
    <p>Nhập mật khẩu mới cho tài khoản <strong>@contact</strong>.</p>
</div>
@if (!string.IsNullOrEmpty(error))
{
    <div class="alert alert-danger">@error</div>
}
<form id="resetPasswordForm" method="post" asp-action="ResetPassword" asp-controller="ForgotPassword">
    <input type="hidden" name="Contact" value="@contact" />
    <input type="hidden" name="Otp" value="@otp" />
    <div class="mb-3">
        <label for="newPassword" class="form-label">Mật khẩu mới</label>
        <input type="password" class="form-control" id="newPassword" name="NewPassword" placeholder="Nhập mật khẩu mới" required minlength="6" />
        <span class="text-danger" id="newPasswordError"></span>
    </div>
    <div class="mb-3">
        <label for="confirmPassword" class="form-label">Xác nhận mật khẩu mới</label>
        <input type="password" class="form-control" id="confirmPassword" name="ConfirmPassword" placeholder="Nhập lại mật khẩu mới" required minlength="6" />
        <span class="text-danger" id="confirmPasswordError"></span>
    </div>
    <button type="submit" class="btn btn-primary w-100 py-2 fs-4 mb-4">Đặt lại mật khẩu</button>
</form>

@section Scripts {
    <script>
        document.getElementById('resetPasswordForm').addEventListener('submit', function (e) {
            var newPassword = document.getElementById('newPassword').value.trim();
            var confirmPassword = document.getElementById('confirmPassword').value.trim();
            var newPasswordError = document.getElementById('newPasswordError');
            var confirmPasswordError = document.getElementById('confirmPasswordError');
            newPasswordError.textContent = '';
            confirmPasswordError.textContent = '';

            let valid = true;
            if (newPassword.length < 8) {
                newPasswordError.textContent = 'Mật khẩu phải có ít nhất 8 ký tự.';
                valid = false;
            }
            if (newPassword !== confirmPassword) {
                confirmPasswordError.textContent = 'Mật khẩu xác nhận không khớp.';
                valid = false;
            }
            if (!valid) {
                e.preventDefault();
            }
        });
    </script>
}
