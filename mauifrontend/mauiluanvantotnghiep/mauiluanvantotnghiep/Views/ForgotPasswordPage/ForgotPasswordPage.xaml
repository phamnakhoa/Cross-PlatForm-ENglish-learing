<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="mauiluanvantotnghiep.Views.ForgotPasswordPage.ForgotPasswordPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:mauiluanvantotnghiep.ViewModels"
    Title="Quên Mật Khẩu"
    Shell.NavBarIsVisible="False">

    <ContentPage.BindingContext>
        <vm:ForgotPasswordViewModel />
    </ContentPage.BindingContext>

    <Grid RowDefinitions="1*,8*,1*">
        <!--  Logo  -->
        <Image
            Margin="10,30,10,10"
            HeightRequest="200"
            HorizontalOptions="Start"
            IsAnimationPlaying="True"
            Source="logo.gif"
            WidthRequest="150" />

        <!--  Background decorative frames  -->
        <Frame
            Grid.Row="0"
            Margin="0,-80,-80,0"
            Padding="0"
            BackgroundColor="#cfd0d8"
            CornerRadius="125"
            HeightRequest="250"
            HorizontalOptions="EndAndExpand"
            WidthRequest="250" />

        <Frame
            Grid.Row="0"
            Margin="0,-120,-120,0"
            Padding="0"
            BackgroundColor="#6600FF"
            CornerRadius="125"
            HeightRequest="250"
            HorizontalOptions="EndAndExpand"
            WidthRequest="250" />

        <!--  Main content frame  -->
        <Frame
            Grid.Row="1"
            Margin="20,0,20,0"
            BackgroundColor="White"
            CornerRadius="0"
            VerticalOptions="CenterAndExpand">

            <ScrollView>
                <VerticalStackLayout Padding="20" Spacing="25">
                    <Label
                        FontAttributes="Bold"
                        FontSize="28"
                        HorizontalTextAlignment="Center"
                        Text="Quên Mật Khẩu" />

                    <Label
                        FontSize="16"
                        HorizontalTextAlignment="Center"
                        Text="Nhập email của bạn để nhận mã OTP khôi phục mật khẩu"
                        TextColor="Gray" />

                    <!--  Email input section  -->
                    <Frame
                        Padding="10"
                        BorderColor="Transparent"
                        CornerRadius="0">
                        <Grid ColumnDefinitions="30,*" ColumnSpacing="10">
                            <Image
                                HeightRequest="25"
                                Source="email.png"
                                VerticalOptions="Center"
                                WidthRequest="25" />
                            <Entry
                                Grid.Column="1"
                                Keyboard="Email"
                                Placeholder="Email"
                                Text="{Binding Email, Mode=TwoWay}"
                                VerticalOptions="Center" />
                        </Grid>
                    </Frame>

                    <!--  Email error message  -->
                    <Label
                        Margin="40,0,0,0"
                        FontSize="12"
                        HorizontalOptions="Start"
                        IsVisible="{Binding IsEmailErrorVisible}"
                        Text="{Binding EmailError}"
                        TextColor="Red" />

                    <!--  Send OTP button  -->
                    <Button
                        Command="{Binding SendOtpCommand}"
                        CornerRadius="0"
                        FontAttributes="Bold"
                        FontSize="18"
                        HeightRequest="50"
                        IsEnabled="{Binding IsSendOtpButtonEnabled}"
                        Text="{Binding SendOtpButtonText}" />

                    <!--  OTP verification section  -->
                    <VerticalStackLayout IsVisible="{Binding IsOtpSectionVisible}" Spacing="15">

                        <Label
                            FontSize="16"
                            HorizontalTextAlignment="Center"
                            Text="Nhập mã OTP đã được gửi về email"
                            TextColor="Gray" />

                        <!--  OTP input  -->
                        <Frame
                            Padding="10"
                            BorderColor="Transparent"
                            CornerRadius="0">
                            <Grid ColumnDefinitions="30,*" ColumnSpacing="10">
                                <Image
                                    HeightRequest="25"
                                    Source="password.png"
                                    VerticalOptions="Center"
                                    WidthRequest="25" />
                                <Entry
                                    Grid.Column="1"
                                    Keyboard="Numeric"
                                    MaxLength="6"
                                    Placeholder="Nhập mã OTP (6 chữ số)"
                                    Text="{Binding Otp, Mode=TwoWay}"
                                    VerticalOptions="Center" />
                            </Grid>
                        </Frame>

                        <!--  OTP error message  -->
                        <Label
                            Margin="40,0,0,0"
                            FontSize="12"
                            HorizontalOptions="Start"
                            IsVisible="{Binding IsOtpErrorVisible}"
                            Text="{Binding OtpError}"
                            TextColor="Red" />

                        <!--  Verify OTP button  -->
                        <Button
                            BackgroundColor="#28a745"
                            Command="{Binding VerifyOtpCommand}"
                            CornerRadius="0"
                            FontAttributes="Bold"
                            FontSize="18"
                            HeightRequest="50"
                            IsEnabled="{Binding IsVerifyOtpButtonEnabled}"
                            Text="Xác Minh OTP" />
                    </VerticalStackLayout>

                    <!--  Password reset section  -->
                    <VerticalStackLayout IsVisible="{Binding IsPasswordResetSectionVisible}" Spacing="15">

                        <Label
                            FontSize="16"
                            HorizontalTextAlignment="Center"
                            Text="Nhập mật khẩu mới"
                            TextColor="Gray" />

                        <!--  New Password input  -->
                        <Frame
                            Padding="10"
                            BorderColor="Transparent"
                            CornerRadius="0">
                            <Grid ColumnDefinitions="30,*,30" ColumnSpacing="10">
                                <Image
                                    HeightRequest="25"
                                    Source="password.png"
                                    VerticalOptions="Center"
                                    WidthRequest="25" />
                                <Entry
                                    Grid.Column="1"
                                    IsPassword="{Binding IsNewPassword, Mode=TwoWay}"
                                    Placeholder="Mật khẩu mới"
                                    Text="{Binding NewPassword, Mode=TwoWay}"
                                    VerticalOptions="Center" />
                                <ImageButton
                                    Grid.Column="2"
                                    Command="{Binding ToggleNewPasswordVisibilityCommand}"
                                    HeightRequest="25"
                                    Source="{Binding NewPasswordEyeIconSource}"
                                    VerticalOptions="Center"
                                    WidthRequest="25" />
                            </Grid>
                        </Frame>

                        <!--  Password strength indicators  -->
                        <VerticalStackLayout Margin="10,0" Spacing="5">
                            <Label
                                FontSize="12"
                                Text="Yêu cầu mật khẩu:"
                                TextColor="Gray" />

                            <HorizontalStackLayout Spacing="5">
                                <Label Text="●" TextColor="{Binding IsLengthValid, Converter={StaticResource BoolToColorConverter}}" />
                                <Label
                                    FontSize="11"
                                    Text="Ít nhất 8 ký tự"
                                    TextColor="Gray" />
                            </HorizontalStackLayout>

                            <HorizontalStackLayout Spacing="5">
                                <Label Text="●" TextColor="{Binding IsUpperCaseValid, Converter={StaticResource BoolToColorConverter}}" />
                                <Label
                                    FontSize="11"
                                    Text="Chứa chữ hoa"
                                    TextColor="Gray" />
                            </HorizontalStackLayout>

                            <HorizontalStackLayout Spacing="5">
                                <Label Text="●" TextColor="{Binding IsLowerCaseValid, Converter={StaticResource BoolToColorConverter}}" />
                                <Label
                                    FontSize="11"
                                    Text="Chứa chữ thường"
                                    TextColor="Gray" />
                            </HorizontalStackLayout>

                            <HorizontalStackLayout Spacing="5">
                                <Label Text="●" TextColor="{Binding IsDigitValid, Converter={StaticResource BoolToColorConverter}}" />
                                <Label
                                    FontSize="11"
                                    Text="Chứa số"
                                    TextColor="Gray" />
                            </HorizontalStackLayout>

                            <HorizontalStackLayout Spacing="5">
                                <Label Text="●" TextColor="{Binding IsSpecialCharValid, Converter={StaticResource BoolToColorConverter}}" />
                                <Label
                                    FontSize="11"
                                    Text="Chứa ký tự đặc biệt"
                                    TextColor="Gray" />
                            </HorizontalStackLayout>
                        </VerticalStackLayout>

                        <!--  New Password error message  -->
                        <Label
                            Margin="40,0,0,0"
                            FontSize="12"
                            HorizontalOptions="Start"
                            IsVisible="{Binding IsPasswordErrorVisible}"
                            Text="{Binding PasswordError}"
                            TextColor="Red" />

                        <!--  Confirm Password input  -->
                        <Frame
                            Padding="10"
                            BorderColor="Transparent"
                            CornerRadius="0">
                            <Grid ColumnDefinitions="30,*,30" ColumnSpacing="10">
                                <Image
                                    HeightRequest="25"
                                    Source="password.png"
                                    VerticalOptions="Center"
                                    WidthRequest="25" />
                                <Entry
                                    Grid.Column="1"
                                    IsPassword="{Binding IsConfirmPasswordField, Mode=TwoWay}"
                                    Placeholder="Xác nhận mật khẩu mới"
                                    Text="{Binding ConfirmPassword, Mode=TwoWay}"
                                    VerticalOptions="Center" />
                                <ImageButton
                                    Grid.Column="2"
                                    Command="{Binding ToggleConfirmPasswordVisibilityCommand}"
                                    HeightRequest="25"
                                    Source="{Binding ConfirmPasswordEyeIconSource}"
                                    VerticalOptions="Center"
                                    WidthRequest="25" />
                            </Grid>
                        </Frame>

                        <!--  Confirm Password error message  -->
                        <Label
                            Margin="40,0,0,0"
                            FontSize="12"
                            HorizontalOptions="Start"
                            IsVisible="{Binding IsConfirmPasswordErrorVisible}"
                            Text="{Binding ConfirmPasswordError}"
                            TextColor="Red" />

                        <!--  Reset Password button  -->
                        <Button
                            BackgroundColor="#dc3545"
                            Command="{Binding ResetPasswordCommand}"
                            CornerRadius="0"
                            FontAttributes="Bold"
                            FontSize="18"
                            HeightRequest="50"
                            IsEnabled="{Binding IsResetPasswordButtonEnabled}"
                            Text="Đặt Lại Mật Khẩu" />
                    </VerticalStackLayout>

                    <!--  General message  -->
                    <Label
                        FontSize="14"
                        HorizontalTextAlignment="Center"
                        IsVisible="{Binding GeneralMessage, Converter={StaticResource StringToBoolConverter}}"
                        Text="{Binding GeneralMessage}"
                        TextColor="#6600FF" />

                    <!--  Loading indicator  -->
                    <ActivityIndicator
                        IsRunning="{Binding IsBusy}"
                        IsVisible="{Binding IsBusy}"
                        Color="#6600FF" />

                    <!--  Back to Sign In  -->
                    <HorizontalStackLayout HorizontalOptions="Center" Spacing="10">
                        <Label
                            FontAttributes="Bold"
                            Text="Nhớ mật khẩu?"
                            TextColor="Gray"
                            VerticalTextAlignment="Center" />
                        <Label
                            FontAttributes="Bold"
                            FontSize="18"
                            Text="Đăng Nhập"
                            TextColor="#6600FF">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding BackToSignInCommand}" />
                            </Label.GestureRecognizers>
                        </Label>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </ScrollView>
        </Frame>

        <!--  Bottom decorative frames  -->
        <Frame
            Grid.Row="2"
            Margin="0,0,0,-180"
            Padding="0"
            BackgroundColor="#cfd0d8"
            CornerRadius="125"
            HeightRequest="250"
            HorizontalOptions="StartAndExpand"
            VerticalOptions="EndAndExpand"
            WidthRequest="250" />

        <Frame
            Grid.Row="2"
            Margin="0,0,0,-200"
            Padding="0"
            BackgroundColor="#6600FF"
            CornerRadius="125"
            HeightRequest="250"
            HorizontalOptions="StartAndExpand"
            VerticalOptions="EndAndExpand"
            WidthRequest="250" />
    </Grid>
</ContentPage>